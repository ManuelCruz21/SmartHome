


<!DOCTYPE html>
<html id="htmlId">
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=windows-1252"> 
  <title>Coverage Report > ElectricConsumptionWhSensor</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">SmartHome.sensors</a>
</div>

<h1>Coverage Summary for Class: ElectricConsumptionWhSensor (SmartHome.sensors)</h1>

<table class="coverageStats">
<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Class, %
</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">ElectricConsumptionWhSensor</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (1/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (9/9)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (39/39)
  </span>
</td>
</tr>

</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;package SmartHome.sensors;
&nbsp;import SmartHome.domain.CatalogueSensor;
&nbsp;import SmartHome.domain.Sensor;
&nbsp;import SmartHome.domain.SensorType;
&nbsp;import SmartHome.domain.Value;
&nbsp;import java.time.LocalDateTime;
&nbsp;import java.time.chrono.ChronoLocalDateTime;
&nbsp;import java.time.temporal.ChronoUnit;
&nbsp;import java.util.HashMap;
&nbsp;import java.util.LinkedHashMap;
&nbsp;import java.util.Map;
&nbsp;
&nbsp;/**
&nbsp; * This class represents a sensor that measures electric consumption in Wh.
&nbsp; * It implements the Sensor interface and provides methods for setting the sensor type,
&nbsp; * generating artificial data, filtering power consumptions by time, and calculating consumption in Wh for a given interval.
&nbsp; */
&nbsp;public class ElectricConsumptionWhSensor implements Sensor {
&nbsp;    private SensorType _type;
&nbsp;    private ElectricConsumptionWhValue _ElectricConsumptionWhValue;
&nbsp;    /**
&nbsp;     * Constructor for the ElectricConsumptionWhSensor class.
&nbsp;     * @param catalogue CatalogueSensor object.
&nbsp;     * @throws InstantiationException if the sensor type with description &#39;ElectricConsumptionWh&#39; does not exist in the catalogue.
&nbsp;     */
<b class="fc">&nbsp;    public ElectricConsumptionWhSensor(CatalogueSensor catalogue) throws InstantiationException {</b>
<b class="fc">&nbsp;        setSensorType(catalogue);</b>
&nbsp;    }
&nbsp;    /**
&nbsp;     * Method to set the sensor type.
&nbsp;     * @param catalogue CatalogueSensor object.
&nbsp;     * @throws InstantiationException if the sensor type with description &#39;ElectricConsumptionWh&#39; does not exist in the catalogue.
&nbsp;     */
&nbsp;    private void setSensorType(CatalogueSensor catalogue) throws InstantiationException {
<b class="fc">&nbsp;        SensorType sensorType = catalogue.getSensorType(&quot;ElectricConsumptionWh&quot;);</b>
<b class="fc">&nbsp;        if (sensorType == null) {</b>
<b class="fc">&nbsp;            throw new InstantiationException(&quot;SensorType with description &#39;ElectricConsumptionWh&#39; does not exist.&quot;);</b>
&nbsp;        } else {
<b class="fc">&nbsp;            _type = sensorType;</b>
&nbsp;        }
&nbsp;    }
&nbsp;    /**
&nbsp;     * Method to get the sensor type.
&nbsp;     * @return SensorType object.
&nbsp;     */
&nbsp;    public SensorType getSensorType() {
<b class="fc">&nbsp;        return _type;</b>
&nbsp;    }
&nbsp;    /**
&nbsp;     * Method to generate artificial data with readings of 50Wh.
&nbsp;     * @return Map of LocalDateTime and Integer representing the artificial data.
&nbsp;     */
&nbsp;    //Method to generate artificial data with readings of 50Wh
&nbsp;     Map&lt;LocalDateTime, Integer&gt; artificialDatabaseOfReadingsSetTo50W() {
<b class="fc">&nbsp;        Map&lt;LocalDateTime, Integer&gt; mapAllConsumption = new LinkedHashMap&lt;&gt;();</b>
&nbsp;        // Set artificial data for the last 5 days
<b class="fc">&nbsp;        LocalDateTime startTime = LocalDateTime.now().minusDays(5).truncatedTo(ChronoUnit.MINUTES);</b>
<b class="fc">&nbsp;        LocalDateTime endTime = LocalDateTime.now().truncatedTo(ChronoUnit.MINUTES);</b>
&nbsp;        // Fill the map with readings of 50W every hour
<b class="fc">&nbsp;        LocalDateTime currentTimestamp = startTime;</b>
<b class="fc">&nbsp;        while (currentTimestamp.isBefore(endTime.plusMinutes(1))) {</b>
<b class="fc">&nbsp;            int randomConsumption = 50;</b>
<b class="fc">&nbsp;            mapAllConsumption.put(currentTimestamp, randomConsumption);</b>
<b class="fc">&nbsp;            currentTimestamp = currentTimestamp.plusMinutes(60);</b>
<b class="fc">&nbsp;        }</b>
<b class="fc">&nbsp;        return mapAllConsumption;</b>
&nbsp;    }
&nbsp;    /**
&nbsp;     * Method to get data from database within a selected time period.
&nbsp;     * @param startTimestamp Start timestamp.
&nbsp;     * @param endTimestamp End timestamp.
&nbsp;     * @return Map of LocalDateTime and Integer representing the data within the selected time period.
&nbsp;     * @throws IllegalArgumentException if the start timestamp is after the end timestamp.
&nbsp;     */
&nbsp;    //Method to get data from database within a selected time period
&nbsp;     Map&lt;LocalDateTime, Integer&gt; getDataFromSelectedTimePeriod(LocalDateTime startTimestamp, LocalDateTime endTimestamp) {
<b class="fc">&nbsp;        if (startTimestamp.truncatedTo(ChronoUnit.MINUTES).isAfter(endTimestamp.truncatedTo(ChronoUnit.MINUTES)))</b>
<b class="fc">&nbsp;            throw new IllegalArgumentException(&quot;Start timestamp must be before end timestamp.&quot;);</b>
&nbsp;
<b class="fc">&nbsp;        Map&lt;LocalDateTime, Integer&gt; mapAllConsumption = artificialDatabaseOfReadingsSetTo50W(); // For example purposes, this map is representing a database with all the power consumptions</b>
<b class="fc">&nbsp;        Map&lt;LocalDateTime, Integer&gt; mapChosenTime = filterPowerConsumptionsByTime(startTimestamp.truncatedTo(ChronoUnit.MINUTES),</b>
<b class="fc">&nbsp;                endTimestamp.truncatedTo(ChronoUnit.MINUTES), mapAllConsumption);</b>
<b class="fc">&nbsp;        return mapChosenTime;</b>
&nbsp;    }
&nbsp;    /**
&nbsp;     * Method to filter power consumptions by time.
&nbsp;     * @param startTimestamp Start timestamp.
&nbsp;     * @param endTimestamp End timestamp.
&nbsp;     * @param mapAllConsumption Map of all power consumptions.
&nbsp;     * @return Map of LocalDateTime and Integer representing the filtered power consumptions.
&nbsp;     * @throws IllegalArgumentException if the timestamps are not within the range of the records.
&nbsp;     */
&nbsp;
&nbsp;    //Method to filter power consumptions by time
&nbsp;    private Map&lt;LocalDateTime, Integer&gt; filterPowerConsumptionsByTime(LocalDateTime startTimestamp, LocalDateTime endTimestamp, Map&lt;LocalDateTime, Integer&gt; mapAllConsumption) {
<b class="fc">&nbsp;        if (startTimestamp.isBefore((ChronoLocalDateTime&lt;?&gt;) mapAllConsumption.keySet().toArray()[0])</b>
<b class="fc">&nbsp;                || endTimestamp.isAfter((ChronoLocalDateTime&lt;?&gt;) mapAllConsumption.keySet().toArray()[mapAllConsumption.size() - 1]))</b>
<b class="fc">&nbsp;            throw new IllegalArgumentException(&quot;Timestamps must be within the range of the records.&quot;);</b>
<b class="fc">&nbsp;        Map&lt;LocalDateTime, Integer&gt; filteredPowerConsumptions = mapAllConsumption.entrySet().stream()</b>
<b class="fc">&nbsp;                .filter(entry -&gt; !entry.getKey().isBefore(startTimestamp) &amp;&amp; !entry.getKey().isAfter(endTimestamp))</b>
<b class="fc">&nbsp;                .collect(HashMap::new, (m, v) -&gt; m.put(v.getKey(), v.getValue()), Map::putAll);</b>
<b class="fc">&nbsp;        return filteredPowerConsumptions;</b>
&nbsp;    }
&nbsp;    /**
&nbsp;     * Method to calculate consumption in Wh for a given interval.
&nbsp;     * @param startTimestamp Start timestamp.
&nbsp;     * @param endTimestamp End timestamp.
&nbsp;     * @return Integer representing the consumption in Wh.
&nbsp;     */
&nbsp;    //Method to calculate consumption in Wh for a given interval
&nbsp;     Integer calculateConsumptionInWh(LocalDateTime startTimestamp, LocalDateTime endTimestamp) {
<b class="fc">&nbsp;        Map&lt;LocalDateTime, Integer&gt; mapChosenTime = getDataFromSelectedTimePeriod(startTimestamp, endTimestamp);</b>
<b class="fc">&nbsp;        int consumptionWh = mapChosenTime.values().stream().mapToInt(Integer::intValue).sum();</b>
<b class="fc">&nbsp;        return consumptionWh;</b>
&nbsp;    }
&nbsp;    /**
&nbsp;     * Method to get the value of the sensor for the last 24 hours.
&nbsp;     * @return Value object representing the consumption in Wh for the last 24 hours.
&nbsp;     */
&nbsp;    //Default behaviour of the sensor is to return consumption in Wh for the last 24 hours
&nbsp;    public Value getValue(){
<b class="fc">&nbsp;        int consumptionWh = calculateConsumptionInWh(LocalDateTime.now().minusHours(24), LocalDateTime.now());</b>
<b class="fc">&nbsp;        _ElectricConsumptionWhValue = new ElectricConsumptionWhValue(consumptionWh);</b>
<b class="fc">&nbsp;        return _ElectricConsumptionWhValue;</b>
&nbsp;    }
&nbsp;    /**
&nbsp;     * Method to get the value of the sensor for a given interval.
&nbsp;     * @param startTimestamp Start timestamp.
&nbsp;     * @param endTimestamp End timestamp.
&nbsp;     * @return Value object representing the consumption in Wh for the given interval.
&nbsp;     */
&nbsp;    //Method to get consumption in Wh for a given interval
&nbsp;    public Value getValue(LocalDateTime startTimestamp, LocalDateTime endTimestamp){
<b class="fc">&nbsp;        int consumptionWh = calculateConsumptionInWh(startTimestamp, endTimestamp);</b>
<b class="fc">&nbsp;        _ElectricConsumptionWhValue = new ElectricConsumptionWhValue(consumptionWh);</b>
<b class="fc">&nbsp;        return _ElectricConsumptionWhValue;</b>
&nbsp;    }
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2024-03-10 18:15</div>
</div>
</body>
</html>
