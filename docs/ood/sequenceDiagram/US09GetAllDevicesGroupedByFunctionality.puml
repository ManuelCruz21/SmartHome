@startuml
'https://plantuml.com/sequence-diagram
!pragma layout smetana

participant " " as User

box "Controller" #LightBlue
participant ":GetAllDevicesGroupedByFunctionalityController" as GetAllDevicesGroupedByFunctionalityController
end box

box "Service" #LightGreen
participant "serDevType:ServiceDeviceType" as ServiceDeviceType

participant "serDev:ServiceDevice" as ServiceDevice
end box

box "Repository" #LightYellow
participant "repoDeviceType:RepositoryDeviceType" as RepositoryDeviceType

participant "repoDevice:RepositoryDevice" as RepositoryDevice
end box

box "Assembler" #LightCyan
participant "DeviceTypeAssembler" as DeviceTypeAssembler

participant "deviceTypeDTO : DeviceType2StringDTO" as DeviceType2StringDTO

participant "DeviceAssembler" as DeviceAssembler

participant "deviceDTO : DeviceDTO" as DeviceDTO
end box

autonumber

User o-> GetAllDevicesGroupedByFunctionalityController: getAllDevicesGroupedByFunctionality()

activate GetAllDevicesGroupedByFunctionalityController

GetAllDevicesGroupedByFunctionalityController -> ServiceDeviceType: getDeviceTypes()

activate ServiceDeviceType

ServiceDeviceType -> RepositoryDeviceType: findAll()

activate RepositoryDeviceType

RepositoryDeviceType --> ServiceDeviceType: deviceTypes

deactivate RepositoryDeviceType

ServiceDeviceType -> DeviceTypeAssembler: deviceType2DTO(deviceTypes)

loop for each deviceType in deviceTypes
    activate DeviceTypeAssembler
    create DeviceType2StringDTO
    DeviceTypeAssembler -> DeviceType2StringDTO: deviceTypeAsString(deviceType)

    activate DeviceType2StringDTO

    DeviceType2StringDTO --> DeviceTypeAssembler: deviceTypeDTO

    deactivate DeviceType2StringDTO

    DeviceTypeAssembler -> DeviceTypeAssembler: addDeviceTypeDTOToList(deviceTypeDTO)
end

DeviceTypeAssembler --> ServiceDeviceType: deviceTypeDTOList

deactivate DeviceTypeAssembler

ServiceDeviceType --> GetAllDevicesGroupedByFunctionalityController : deviceTypeDTOList

deactivate ServiceDeviceType



GetAllDevicesGroupedByFunctionalityController -> ServiceDevice : getDevices()

activate ServiceDevice

ServiceDevice -> RepositoryDevice: findAll()

activate RepositoryDevice

RepositoryDevice --> ServiceDevice: devices

deactivate RepositoryDevice

ServiceDevice -> DeviceAssembler: device2DTO(devices)

loop for each device in devices
    activate DeviceAssembler
    create DeviceDTO
    DeviceAssembler -> DeviceDTO: createDeviceDTO(device)

    activate DeviceDTO

    DeviceDTO --> DeviceAssembler: deviceDTO

    deactivate DeviceDTO

    DeviceAssembler -> DeviceAssembler: addDeviceDTOToList(deviceDTO)
end

DeviceAssembler --> ServiceDevice: deviceDTOList

deactivate DeviceAssembler


ServiceDevice --> GetAllDevicesGroupedByFunctionalityController: deviceDTOList

deactivate ServiceDevice

GetAllDevicesGroupedByFunctionalityController -> GetAllDevicesGroupedByFunctionalityController: listDevicesByFunctionality(deviceTypeDTOList, deviceDTOList)

GetAllDevicesGroupedByFunctionalityController --> User: deviceDTOsByFunctionality

deactivate GetAllDevicesGroupedByFunctionalityController

@enduml