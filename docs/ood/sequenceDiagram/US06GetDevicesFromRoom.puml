@startuml
'https://plantuml.com/sequence-diagram
participant " " as User
participant ":GetListOfDevicesFromRoom_Controller" as GetListOfDevicesFromRoom_Controller

participant "serviceRoom:ServiceRoom" as ServiceRoom
participant "serviceDevice:ServiceDevice" as ServiceDevice

participant "RoomAssembler" as RoomAssembler
participant "roomDTO:RoomDTO" as RoomDTO
participant "DeviceAssembler" as DeviceAssembler
participant "deviceDTO:DeviceDTO" as DeviceDTO

participant ":RoomRepo" as RoomRepo
participant ":DeviceRepo" as DeviceRepo

participant ":Room" as Room
participant ":Device" as Device




autonumber


User o-> GetListOfDevicesFromRoom_Controller: getRooms()

activate GetListOfDevicesFromRoom_Controller

GetListOfDevicesFromRoom_Controller -> ServiceRoom: getRooms()

activate ServiceRoom

ServiceRoom -> RoomRepo: findAll()

activate RoomRepo

RoomRepo --> ServiceRoom: listRooms

deactivate RoomRepo

loop for each room
    ServiceRoom -> RoomAssembler : room2DTO(room)

    activate RoomAssembler

    create RoomDTO

    RoomAssembler -> RoomDTO: createRoom2DTO (room)

     activate RoomDTO

     RoomDTO --> RoomAssembler: roomDTO

     deactivate RoomDTO

    RoomAssembler --> ServiceRoom: roomDTO

    deactivate RoomAssembler

    ServiceRoom -> ServiceRoom: saveRoomDTO(roomDTO)

end



ServiceRoom --> GetListOfDevicesFromRoom_Controller: listRoomDTO

deactivate ServiceRoom

GetListOfDevicesFromRoom_Controller --> User : listRoomDTO

User o-> GetListOfDevicesFromRoom_Controller: getDevices(roomDTO)

GetListOfDevicesFromRoom_Controller -> ServiceDevice: getDevices(roomId)

activate ServiceDevice



ServiceDevice -> DeviceRepo: getDevicesByRoomId (roomId)

activate DeviceRepo

DeviceRepo --> ServiceDevice: listDevices

deactivate DeviceRepo

 loop for each device in room

    ServiceDevice  -> DeviceAssembler: device2StringDTO (device)

    activate DeviceAssembler

    create DeviceDTO

    DeviceAssembler -> DeviceDTO: device2StringDTO (device)

    activate DeviceDTO

    DeviceDTO --> DeviceAssembler: strDeviceDTO

    deactivate DeviceDTO

    DeviceAssembler --> ServiceDevice: strDeviceDTO

    deactivate DeviceAssembler

    ServiceDevice -> ServiceDevice: saveDeviceDTO(strDeviceDTO)
end

ServiceDevice --> GetListOfDevicesFromRoom_Controller: listDeviceDTO

deactivate ServiceDevice

GetListOfDevicesFromRoom_Controller --> User : listDeviceDTO

deactivate GetListOfDevicesFromRoom_Controller






@enduml

