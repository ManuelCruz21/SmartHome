@startuml
'https://plantuml.com/sequence-diagram

participant " " as User
participant Controller as ":GetMaxPowerConsumptionOverAPeriod"
participant DeviceService as ":DeviceService"
participant LogService as ":LogService"
participant DeviceRepository as ":DeviceRepository"

autonumber

User o-> Controller: getMaxPowerConsumption(initialTime, endTime)

activate Controller

Controller -> DeviceService: getDevicesByDeviceTypeID(DeviceType powerMeter)

activate DeviceService

DeviceService -> DeviceRepository: getDevicesByDeviceTypeID(DeviceType powerMeter)

activate DeviceRepository

DeviceRepository --> DeviceService: DeviceList

deactivate DeviceRepository

DeviceService -> Controller: DeviceList

deactivate DeviceService

'--------------------------------------------'

Controller -> DeviceService: getDevicesByDeviceType(DeviceType powerSource)

activate DeviceService

DeviceService -> DeviceRepository: getDevicesByDeviceType(DeviceType powerSource)

activate DeviceRepository

DeviceRepository --> DeviceService: DeviceList

deactivate DeviceRepository

DeviceService -> Controller: DeviceList

deactivate DeviceService

'--------------------------------------------'

Controller -> LogService: getDeviceReadingsBySensorTypeAndTimePeriod (powerMeterDeviceID, sensorTypeID, datePeriod)

activate LogService

LogService -> LogRepository: findByDeviceIDAndSensorTypeAndDatePeriodBetween (powerMeterDeviceID, sensorTypeID, datePeriod)

activate LogRepository

LogRepository --> LogService: outsideTemperatureReadings

deactivate LogRepository

LogService --> Controller: outsideTemperatureReadings

deactivate LogService

Controller -> LogService: getDeviceReadingsBySensorTypeAndTimePeriod (powerSourceDeviceID, sensorTypeID, datePeriod)

'--------------------------------------------'

activate LogService

LogService -> LogRepository: findByDeviceIDAndSensorTypeAndDatePeriodBetween (powerSourceDeviceID, sensorTypeID, datePeriod)

activate LogRepository

LogRepository --> LogService: deviceTemperatureReadings

deactivate LogRepository

LogService --> Controller: deviceTemperatureReadings

deactivate LogService

Controller -> LogService: getMaxPowerConsumption(powerMeterReadings, powerSourceReadings, timeDelta)

'--------------------------------------------'

activate LogService

LogService --> Controller: maxPowerConsumptionValue

deactivate LogService

Controller --> User: maxPowerConsumptionValue


deactivate Controller

@enduml